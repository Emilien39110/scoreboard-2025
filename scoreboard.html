<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Décompte 24h + Score X–Y</title>
  <style>
    :root { --bg:#0b0b0b; --fg:#f5f5f5; --muted:#9aa0a6; --accent:#3b82f6; --danger:#ef4444; }
    * { box-sizing: border-box; }
    html, body { height:100%; margin:0; }
    body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--fg); }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 16px; display: grid; gap: 16px; }
    header { display:flex; align-items:center; justify-content:space-between; gap:12px; }
    header h1 { font-size: clamp(18px, 2vw, 24px); margin:0; font-weight: 650; }
    button, input { border-radius: 10px; border: 1px solid #2a2a2a; background:#141414; color:var(--fg); padding:10px 12px; font-size:14px; }
    button { cursor:pointer; }
    button:hover { background:#181818; }
    button.primary { background: var(--accent); border-color: var(--accent); color:white; }
    button.danger { background: var(--danger); border-color: var(--danger); color:white; }
    .panel { border:1px solid #222; background:#111; border-radius: 16px; padding: 16px; }
    .time { text-align:center; font-weight: 800; font-variant-numeric: tabular-nums; }
    .time .big { font-size: clamp(48px, 10vw, 120px); line-height: 1; }
    .time .done { color: var(--danger); font-weight:700; margin-top:6px; }
    .grid { display:grid; gap:16px; grid-template-columns: 1fr; }
    @media (min-width: 900px) { .grid { grid-template-columns: 2fr 1fr; } }
    .scoreboard { display:grid; grid-template-columns: 1fr 1fr; gap:12px; align-items:center; }
    .score-card { border:1px solid #222; background:#0f0f0f; border-radius:16px; padding:16px; text-align:center; }
    .team-name { width:100%; text-align:center; background:#131313; border:1px solid #2a2a2a; padding:8px 10px; border-radius:10px; font-size:14px; }
    .score { font-size: clamp(44px, 8vw, 90px); font-weight:900; line-height:1; font-variant-numeric: tabular-nums; }
    .btns { display:flex; justify-content:center; gap:8px; margin-top:10px; flex-wrap:wrap; }
    .hint { color: var(--muted); font-size: 13px; }
    .center { text-align:center; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Page d'affichage · Décompte 24h & Score X–Y</h1>
      <div class="hint">Raccourcis : Espace (pause/démarrer), R (reset), A/Z = X −/+, K/M = Y −/+, F (plein écran)</div>
    </header>

    <div class="grid">
      <!-- TIMER -->
      <section class="panel">
        <div class="time">
          <div id="timeLeft" class="big">24:00:00</div>
          <div id="done" class="done" style="display:none">Terminé !</div>
        </div>
        <div class="center" style="margin-top:12px;">
          <button id="toggleRun" class="primary">Démarrer</button>
          <button id="reset24" class="danger">Reset 24h</button>
          <button data-add="-60">-1 h</button>
          <button data-add="-5">-5 min</button>
          <button data-add="5">+5 min</button>
          <button data-add="60">+1 h</button>
        </div>
      </section>

      <!-- SCORE -->
      <section class="panel">
        <div class="scoreboard">
          <div class="score-card">
            <input id="nameX" class="team-name" placeholder="Nom équipe X" />
            <div id="scoreX" class="score">0</div>
            <div class="btns">
              <button data-team="X" data-delta="-1">−1</button>
              <button data-team="X" data-delta="1" class="primary">+1</button>
            </div>
          </div>
          <div class="score-card">
            <input id="nameY" class="team-name" placeholder="Nom équipe Y" />
            <div id="scoreY" class="score">0</div>
            <div class="btns">
              <button data-team="Y" data-delta="-1">−1</button>
              <button data-team="Y" data-delta="1" class="primary">+1</button>
            </div>
          </div>
        </div>
        <div class="center" style="margin-top:12px;">
          <button id="resetScores">Réinitialiser X–Y</button>
        </div>
      </section>
    </div>

    <section class="panel hint">
      L'état (scores, noms, timer) est sauvegardé automatiquement dans votre navigateur (localStorage).
    </section>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);
    const pad2 = (n) => String(n).padStart(2, "0");
    const now = () => Date.now();
    const DAY_MS = 24 * 60 * 60 * 1000;
    const fmt = (ms) => {
      if (ms < 0) ms = 0;
      const t = Math.floor(ms / 1000);
      const h = Math.floor((t % (24 * 3600)) / 3600);
      const m = Math.floor((t % 3600) / 60);
      const s = t % 60;
      return `${pad2(h)}:${pad2(m)}:${pad2(s)}`;
    };
    const readLS = (k, d) => { try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : d; } catch { return d; } };
    const writeLS = (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} };

    // TIMER
    let endTime = readLS('endTime', null);
    let running = readLS('running', false);
    const timeLeftEl = $('#timeLeft');
    const doneEl = $('#done');
    const toggleBtn = $('#toggleRun');

    function tick() {
      if (!endTime) return;
      const rem = Math.max(0, endTime - now());
      timeLeftEl.textContent = fmt(rem);
      doneEl.style.display = rem === 0 ? 'block' : 'none';
      if (rem === 0) running = false;
    }

    let iv;
    function startTicker() {
      if (iv) clearInterval(iv);
      if (running) iv = setInterval(tick, 250);
      tick();
    }

    function updateRunBtn() {
      toggleBtn.textContent = running ? "Pause" : "Démarrer";
    }

    toggleBtn.onclick = () => {
      if (!running) {
        // Démarre un décompte de 24h à partir de maintenant
        endTime = now() + DAY_MS;
        writeLS('endTime', endTime);
      }
      running = !running;
      writeLS('running', running);
      updateRunBtn();
      startTicker();
    };

    $('#reset24').onclick = () => {
      endTime = null;
      running = false;
      timeLeftEl.textContent = "24:00:00";
      doneEl.style.display = "none";
      writeLS('endTime', null);
      writeLS('running', false);
      updateRunBtn();
      if (iv) clearInterval(iv);
    };

    document.querySelectorAll('button[data-add]').forEach(b => b.onclick = () => {
      if (!endTime) return; // inactif si pas lancé
      endTime = Math.max(now(), endTime + Number(b.dataset.add) * 60 * 1000);
      writeLS('endTime', endTime);
      tick();
    });

    // SCORES
    let scoreX = readLS('scoreX', 0);
    let scoreY = readLS('scoreY', 0);
    const scoreXEl = $('#scoreX'), scoreYEl = $('#scoreY');
    const renderScores = () => { scoreXEl.textContent = scoreX; scoreYEl.textContent = scoreY; };
    const changeScore = (t, d) => {
      if (t === 'X') { scoreX = Math.max(0, scoreX + d); writeLS('scoreX', scoreX); }
      else { scoreY = Math.max(0, scoreY + d); writeLS('scoreY', scoreY); }
      renderScores();
    };
    document.querySelectorAll('button[data-team]').forEach(b => b.onclick = () => changeScore(b.dataset.team, Number(b.dataset.delta)));
    $('#resetScores').onclick = () => { scoreX = 0; scoreY = 0; writeLS('scoreX', 0); writeLS('scoreY', 0); renderScores(); };

    // NOMS
    const nameX = $('#nameX'), nameY = $('#nameY');
    nameX.value = readLS('nameX', 'Équipe X');
    nameY.value = readLS('nameY', 'Équipe Y');
    nameX.oninput = () => writeLS('nameX', nameX.value);
    nameY.oninput = () => writeLS('nameY', nameY.value);

    // CLAVIER
    document.addEventListener('keydown', (e) => {
      if (e.repeat) return;
      const k = e.key.toLowerCase();
      if (k === ' ') { toggleBtn.click(); e.preventDefault(); }
      else if (k === 'r') { $('#reset24').click(); }
      else if (k === 'f') { if (!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }
      else if (k === 'a') changeScore('X', -1);
      else if (k === 'z') changeScore('X', +1);
      else if (k === 'k') changeScore('Y', -1);
      else if (k === 'm') changeScore('Y', +1);
    });

    updateRunBtn();
    renderScores();
    startTicker();
  </script>
</body>
</html>
